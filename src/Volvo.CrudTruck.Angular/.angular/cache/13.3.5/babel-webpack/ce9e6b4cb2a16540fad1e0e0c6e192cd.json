{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { environment } from '@env/environment';\nimport { Logger, UntilDestroy, untilDestroyed } from '@core';\nimport { AuthenticationService } from './authentication.service';\nimport { SwPush } from '@angular/service-worker';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"./authentication.service\";\nimport * as i4 from \"@angular/service-worker\";\nimport * as i5 from \"@ngx-translate/core\";\nimport * as i6 from \"../i18n/language-selector.component\";\nconst log = new Logger('Login');\nlet LoginComponent = class LoginComponent {\n  constructor(router, route, formBuilder, authenticationService, swPush) {\n    this.router = router;\n    this.route = route;\n    this.formBuilder = formBuilder;\n    this.authenticationService = authenticationService;\n    this.swPush = swPush;\n    this.version = environment.version;\n    this.isLoading = false;\n    this.createForm();\n  }\n\n  ngOnInit() {}\n\n  login() {\n    this.isLoading = true;\n    this.authenticationService.login(this.loginForm.value).then(res => {\n      this.isLoading = false;\n\n      if (!res.error) {\n        this.notifyNewLogin();\n        this.error = undefined;\n        const data = {\n          username: res.data.name,\n          token: res.data.accessToken\n        };\n        this.loginForm.markAsPristine();\n        untilDestroyed(this);\n        this.router.navigate([this.route.snapshot.queryParams.redirect || '/'], {\n          replaceUrl: true\n        });\n        this.authenticationService.credentialsService.setCredentials(data, false);\n      } else {\n        console.log(res.message);\n        this.error = res.message;\n      }\n    }).finally(() => this.isLoading = false);\n  }\n\n  notifyNewLogin() {\n    this.subscribeToPush();\n    console.log('isEnabled');\n    console.log(this.swPush.isEnabled); // this.swPush.messages.subscribe(message=>{\n    //   console.log('message')\n    //   console.log(message)\n    // })\n\n    this.swPush.notificationClicks.subscribe(notpayload => {\n      console.log('Action: ' + notpayload.action + 'Notification data: ' + notpayload.notification.data + 'Notification data.url: ' + notpayload.notification.data.url + 'Notification data.body: ' + notpayload.notification.body);\n      window.open(notpayload.notification.data.url, \"_blank\");\n    });\n  }\n\n  createForm() {\n    this.loginForm = this.formBuilder.group({\n      login: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  subscribeToPush() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {// const sub = await this.swPush.requestSubscription({\n        //   serverPublicKey: PUBLIC_VAPID_KEY_OF_SERVER,\n        // });\n        // TODO: Send to server.\n      } catch (err) {\n        console.error('Could not subscribe due to:', err);\n      }\n    });\n  }\n\n};\n\nLoginComponent.ɵfac = function LoginComponent_Factory(t) {\n  return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.AuthenticationService), i0.ɵɵdirectiveInject(i4.SwPush));\n};\n\nLoginComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: LoginComponent,\n  selectors: [[\"app-login\"]],\n  decls: 88,\n  vars: 12,\n  consts: [[1, \"login-container\", \"bg-light\"], [1, \"login-box\"], [\"translate\", \"\"], [1, \"d-inline-block\", \"ml-3\"], [1, \"container\"], [1, \"card\", \"col-md-6\", \"mt-3\", \"mx-auto\"], [1, \"card-body\"], [1, \"card-title\", \"text-center\"], [1, \"far\", \"fa-3x\", \"fa-user-circle\", \"text-muted\"], [\"novalidate\", \"\", 3, \"formGroup\", \"ngSubmit\"], [\"translate\", \"\", 1, \"alert\", \"alert-danger\", 3, \"hidden\"], [1, \"form-group\"], [1, \"d-block\"], [\"type\", \"text\", \"formControlName\", \"login\", \"autocomplete\", \"username\", 1, \"form-control\", 3, \"placeholder\"], [\"hidden\", \"\", \"translate\", \"\"], [\"translate\", \"\", 1, \"text-danger\", 3, \"hidden\"], [\"type\", \"password\", \"formControlName\", \"password\", \"autocomplete\", \"current-password\", \"required\", \"\", 1, \"form-control\", 3, \"placeholder\"], [1, \"form-check\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"w-100\", 3, \"disabled\"], [1, \"fas\", \"fa-cog\", \"fa-spin\", 3, \"hidden\"]],\n  template: function LoginComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtext(1, \"\\n  \");\n      i0.ɵɵelementStart(2, \"div\", 1);\n      i0.ɵɵtext(3, \"\\n    \");\n      i0.ɵɵelementStart(4, \"h1\", 2);\n      i0.ɵɵtext(5, \"APP_NAME\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(6, \"\\n    \");\n      i0.ɵɵelementStart(7, \"div\");\n      i0.ɵɵtext(8, \"\\n      \");\n      i0.ɵɵelementStart(9, \"h6\", 3);\n      i0.ɵɵtext(10, \"Usu\\u00E1rio:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(11, \"\\n      \");\n      i0.ɵɵelementStart(12, \"span\");\n      i0.ɵɵtext(13, \"Rkohl\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(14, \"\\n      \");\n      i0.ɵɵelement(15, \"br\");\n      i0.ɵɵtext(16, \"\\n      \");\n      i0.ɵɵelementStart(17, \"h6\", 3);\n      i0.ɵɵtext(18, \"Senha:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(19, \"\\n      \");\n      i0.ɵɵelementStart(20, \"span\");\n      i0.ɵɵtext(21, \"123\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(22, \"\\n      \");\n      i0.ɵɵelementStart(23, \"div\", 3);\n      i0.ɵɵtext(24, \"\\n        \");\n      i0.ɵɵelement(25, \"app-language-selector\");\n      i0.ɵɵtext(26, \"\\n      \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(27, \"\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(28, \"\\n    \");\n      i0.ɵɵelementStart(29, \"div\", 4);\n      i0.ɵɵtext(30, \"\\n      \");\n      i0.ɵɵelementStart(31, \"div\", 5);\n      i0.ɵɵtext(32, \"\\n        \");\n      i0.ɵɵelementStart(33, \"div\", 6);\n      i0.ɵɵtext(34, \"\\n          \");\n      i0.ɵɵelementStart(35, \"h4\", 7);\n      i0.ɵɵtext(36, \"\\n            \");\n      i0.ɵɵelement(37, \"i\", 8);\n      i0.ɵɵtext(38, \"\\n          \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(39, \"\\n          \");\n      i0.ɵɵelementStart(40, \"form\", 9);\n      i0.ɵɵlistener(\"ngSubmit\", function LoginComponent_Template_form_ngSubmit_40_listener() {\n        return ctx.login();\n      });\n      i0.ɵɵtext(41, \"\\n            \");\n      i0.ɵɵelementStart(42, \"div\", 10);\n      i0.ɵɵtext(43, \"\\n              Username or password incorrect.\\n            \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(44, \"\\n            \");\n      i0.ɵɵelementStart(45, \"div\", 11);\n      i0.ɵɵtext(46, \"\\n              \");\n      i0.ɵɵelementStart(47, \"label\", 12);\n      i0.ɵɵtext(48, \"\\n                \");\n      i0.ɵɵelement(49, \"input\", 13);\n      i0.ɵɵpipe(50, \"translate\");\n      i0.ɵɵtext(51, \"\\n                \");\n      i0.ɵɵelementStart(52, \"span\", 14);\n      i0.ɵɵtext(53, \"Username\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(54, \"\\n                \");\n      i0.ɵɵelementStart(55, \"small\", 15);\n      i0.ɵɵtext(56, \"\\n                  Username is required\\n                \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(57, \"\\n              \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(58, \"\\n              \");\n      i0.ɵɵelementStart(59, \"label\", 12);\n      i0.ɵɵtext(60, \"\\n                \");\n      i0.ɵɵelement(61, \"input\", 16);\n      i0.ɵɵpipe(62, \"translate\");\n      i0.ɵɵtext(63, \"\\n                \");\n      i0.ɵɵelementStart(64, \"span\", 14);\n      i0.ɵɵtext(65, \"Password\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(66, \"\\n                \");\n      i0.ɵɵelementStart(67, \"small\", 15);\n      i0.ɵɵtext(68, \"\\n                  Password is required\\n                \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(69, \"\\n              \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(70, \"\\n              \");\n      i0.ɵɵelement(71, \"div\", 17);\n      i0.ɵɵtext(72, \"\\n            \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(73, \"\\n            \");\n      i0.ɵɵelementStart(74, \"button\", 18);\n      i0.ɵɵtext(75, \"\\n              \");\n      i0.ɵɵelement(76, \"i\", 19);\n      i0.ɵɵtext(77, \"\\n              \");\n      i0.ɵɵelementStart(78, \"span\", 2);\n      i0.ɵɵtext(79, \"Login\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(80, \"\\n            \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(81, \"\\n          \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(82, \"\\n        \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(83, \"\\n      \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(84, \"\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(85, \"\\n  \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(86, \"\\n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(87, \"\\n\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(40);\n      i0.ɵɵproperty(\"formGroup\", ctx.loginForm);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hidden\", !ctx.error || ctx.isLoading);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(50, 8, \"Username\"));\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"hidden\", ctx.loginForm.controls.login.valid || ctx.loginForm.controls.login.untouched);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(62, 10, \"Password\"));\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"hidden\", ctx.loginForm.controls.password.valid || ctx.loginForm.controls.password.untouched);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"disabled\", ctx.loginForm.invalid || ctx.isLoading);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hidden\", !ctx.isLoading);\n    }\n  },\n  directives: [i5.TranslateDirective, i6.LanguageSelectorComponent, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i2.RequiredValidator],\n  pipes: [i5.TranslatePipe],\n  styles: [\".login-container[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0}.login-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;min-height:100%}.ng-invalid.ng-touched[_ngcontent-%COMP%]:not(form){border-left:4px solid theme-color(\\\"danger\\\")}.container[_ngcontent-%COMP%]{width:100%}\"]\n});\nLoginComponent = __decorate([UntilDestroy(), __metadata(\"design:paramtypes\", [Router, ActivatedRoute, FormBuilder, AuthenticationService, SwPush])], LoginComponent);\nexport { LoginComponent };","map":null,"metadata":{},"sourceType":"module"}