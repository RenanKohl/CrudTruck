{"ast":null,"code":"import { FormBuilder, Validators } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Logger } from '@app/@core';\nimport { CredentialsService } from '@app/auth';\nimport { I18nService } from '@app/i18n';\nimport { TranslateService } from '@ngx-translate/core';\nimport { parseInt } from 'lodash';\nimport * as moment from 'moment';\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport { ToastrService } from 'ngx-toastr';\nimport { switchMap } from 'rxjs/operators';\nimport Swal from 'sweetalert2';\nimport { TruckModel } from '../model/truck.model';\nimport { TruckService } from '../services/truck.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/truck.service\";\nimport * as i2 from \"@app/auth\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"ngx-spinner\";\nimport * as i5 from \"@ngx-translate/core\";\nimport * as i6 from \"@app/i18n\";\nimport * as i7 from \"@angular/router\";\nimport * as i8 from \"@angular/forms\";\n\nfunction FormPageComponent_option_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const year_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", year_r1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(year_r1);\n  }\n}\n\nconst _c0 = function () {\n  return {\n    text: \"Home\",\n    link: \"/\"\n  };\n};\n\nconst _c1 = function () {\n  return {\n    text: \"Truck\",\n    link: \"/truck\"\n  };\n};\n\nconst _c2 = function (a0) {\n  return {\n    text: a0\n  };\n};\n\nconst _c3 = function (a0, a1, a2) {\n  return [a0, a1, a2];\n};\n\nconst _c4 = function (a0) {\n  return {\n    \"is-invalid\": a0\n  };\n};\n\nconst log = new Logger('FormPageComponent');\nexport let FormPageComponent = /*#__PURE__*/(() => {\n  class FormPageComponent {\n    constructor(truckService, credentialsService, toastr, spinner, translateService, i18nService, router, route, formBuilder) {\n      this.truckService = truckService;\n      this.credentialsService = credentialsService;\n      this.toastr = toastr;\n      this.spinner = spinner;\n      this.translateService = translateService;\n      this.i18nService = i18nService;\n      this.router = router;\n      this.route = route;\n      this.formBuilder = formBuilder;\n      this.serverErrorMessages = null;\n      this.submittingForm = false;\n      this.yearModels = [];\n    }\n\n    getTranslations() {\n      this.editLabel = this.translateService.instant('Edit');\n      this.newLabel = this.translateService.instant('New');\n    }\n\n    ngOnInit() {\n      this.token = this.credentialsService.credentials.token;\n      this.getTranslations();\n      this.setCurrentAction();\n      this.buildForm();\n      this.loadResource(this.token);\n      this.getYears();\n    }\n\n    loadResource(token) {\n      this.spinner.show();\n\n      if (this.currentAction == 'edit') {\n        this.route.paramMap.pipe(switchMap(params => {\n          return this.truckService.getById(parseInt(params.get('id')), token);\n        })).subscribe(resource => {\n          this.truck = resource.data;\n          this.formData.patchValue(resource.data);\n          this.spinner.hide();\n        }, error => {\n          Swal.fire('Aviso', 'Ocorreu um erro no servidor, tente mais tarde.');\n          console.log(error);\n        });\n      }\n\n      this.spinner.hide();\n    }\n\n    submitForm(event) {\n      this.spinner.show();\n      this.submittingForm = true;\n\n      if (this.currentAction === 'new') {\n        this.create();\n      } else {\n        this.update();\n      } // this.spinner.hide();\n\n    }\n\n    ngAfterContentChecked() {\n      this.setPageTitle();\n    }\n\n    back() {\n      this.router.navigateByUrl('/truck');\n    }\n\n    getYears() {\n      let year = moment().year();\n\n      for (let i = year; i < year + 2; i++) {\n        this.yearModels.push(i);\n      }\n    }\n\n    create() {\n      let model = Object.assign(this.formData.value, TruckModel);\n      this.truckService.create(model, this.token).subscribe(response => this.actionsForSuccess(response), error => this.actionsForError(error));\n    }\n\n    update() {\n      let model = Object.assign(this.formData.value, TruckModel);\n      this.truckService.update(this.truck.id, model, this.token).subscribe(response => this.actionsForSuccess(response), error => this.actionsForError(error));\n    }\n\n    actionsForSuccess(response) {\n      if (!response.error) {\n        this.toastr.success(response.message, '');\n      }\n\n      const baseComponentPath = this.route.snapshot.parent.url[0].path;\n      this.router.navigateByUrl(baseComponentPath, {\n        skipLocationChange: true\n      }).then(() => {\n        this.router.navigate([baseComponentPath, this.truck.id, 'edit']);\n      });\n    }\n\n    actionsForError(error) {\n      this.submittingForm = false;\n      this.spinner.hide();\n      log.error(error);\n    }\n\n    buildForm() {\n      this.formData = this.formBuilder.group({\n        model: [null, [Validators.required]],\n        modelYear: [null, [Validators.required]]\n      });\n    }\n\n    setCurrentAction() {\n      if (this.route.snapshot.url[0].path === 'new') {\n        this.currentAction = 'new';\n      } else {\n        this.currentAction = 'edit';\n      }\n    }\n\n    setPageTitle() {\n      if (this.currentAction === 'new') {\n        this.pageTitle = this.newLabel;\n      } else {\n        this.pageTitle = this.editLabel;\n      }\n    }\n\n  }\n\n  FormPageComponent.ɵfac = function FormPageComponent_Factory(t) {\n    return new (t || FormPageComponent)(i0.ɵɵdirectiveInject(i1.TruckService), i0.ɵɵdirectiveInject(i2.CredentialsService), i0.ɵɵdirectiveInject(i3.ToastrService), i0.ɵɵdirectiveInject(i4.NgxSpinnerService), i0.ɵɵdirectiveInject(i5.TranslateService), i0.ɵɵdirectiveInject(i6.I18nService), i0.ɵɵdirectiveInject(i7.Router), i0.ɵɵdirectiveInject(i7.ActivatedRoute), i0.ɵɵdirectiveInject(i8.FormBuilder));\n  };\n\n  FormPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FormPageComponent,\n    selectors: [[\"app-form-page\"]],\n    decls: 82,\n    vars: 28,\n    consts: [[1, \"container-fluid\"], [3, \"titulo\", \"items\"], [1, \"row\"], [1, \"col-md-12\"], [1, \"card\", \"ml-2\", \"mr-2\", \"mb-2\", \"mt-2\"], [3, \"formGroup\", \"ngSubmit\", \"keydown.enter\"], [1, \"card-body\"], [\"bdColor\", \"rgba(0,0,0,0.3)\", \"size\", \"small\", \"color\", \"#fff\", \"type\", \"line-scale\", 3, \"fullScreen\"], [\"translate\", \"\", 2, \"color\", \"white\"], [1, \"form-row\"], [1, \"col\"], [1, \"form-group\"], [\"for\", \"name\", \"translate\", \"\", 1, \"mb-1\"], [\"formControlName\", \"model\", 1, \"form-control\", 3, \"ngClass\"], [\"value\", \"FH\"], [\"value\", \"FM\"], [3, \"form-control\"], [\"formControlName\", \"modelYear\", 1, \"form-control\", 3, \"ngClass\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [1, \"card-footer\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"btn-sm\", \"mr-1\", 3, \"disabled\"], [1, \"far\", \"fa-save\"], [\"type\", \"button\", 1, \"btn\", \"btn-default\", \"btn-sm\", 3, \"click\"], [1, \"fas\", \"fa-arrow-alt-circle-left\"], [3, \"ngValue\"]],\n    template: function FormPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtext(1, \"\\n  \");\n        i0.ɵɵelement(2, \"app-bread-crumb\", 1);\n        i0.ɵɵtext(3, \"\\n\\n  \");\n        i0.ɵɵelementStart(4, \"div\", 2);\n        i0.ɵɵtext(5, \"\\n    \");\n        i0.ɵɵelementStart(6, \"div\", 3);\n        i0.ɵɵtext(7, \"\\n      \");\n        i0.ɵɵelementStart(8, \"div\", 4);\n        i0.ɵɵtext(9, \"\\n        \");\n        i0.ɵɵelementStart(10, \"form\", 5);\n        i0.ɵɵlistener(\"ngSubmit\", function FormPageComponent_Template_form_ngSubmit_10_listener($event) {\n          return ctx.submitForm($event);\n        })(\"keydown.enter\", function FormPageComponent_Template_form_keydown_enter_10_listener($event) {\n          return $event.preventDefault();\n        });\n        i0.ɵɵtext(11, \"\\n          \");\n        i0.ɵɵelementStart(12, \"div\", 6);\n        i0.ɵɵtext(13, \"\\n            \");\n        i0.ɵɵelementStart(14, \"ngx-spinner\", 7);\n        i0.ɵɵtext(15, \"\\n              \");\n        i0.ɵɵelementStart(16, \"p\", 8);\n        i0.ɵɵtext(17, \"Loading\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(18, \"\\n            \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(19, \"\\n            \");\n        i0.ɵɵelementStart(20, \"div\", 9);\n        i0.ɵɵtext(21, \"\\n              \");\n        i0.ɵɵelementStart(22, \"div\", 10);\n        i0.ɵɵtext(23, \"\\n                \");\n        i0.ɵɵelementStart(24, \"div\", 11);\n        i0.ɵɵtext(25, \"\\n                  \");\n        i0.ɵɵelementStart(26, \"label\", 12);\n        i0.ɵɵtext(27, \"Model\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(28, \"\\n                  \");\n        i0.ɵɵelementStart(29, \"select\", 13);\n        i0.ɵɵtext(30, \"\\n                    \");\n        i0.ɵɵelementStart(31, \"option\", 14);\n        i0.ɵɵtext(32, \"FH\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(33, \"\\n                    \");\n        i0.ɵɵelementStart(34, \"option\", 15);\n        i0.ɵɵtext(35, \"FM\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(36, \"\\n                  \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(37, \"\\n                  \");\n        i0.ɵɵelement(38, \"app-form-field-error\", 16);\n        i0.ɵɵtext(39, \"\\n                \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(40, \"\\n              \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(41, \"\\n              \");\n        i0.ɵɵelementStart(42, \"div\", 10);\n        i0.ɵɵtext(43, \"\\n                \");\n        i0.ɵɵelementStart(44, \"div\", 11);\n        i0.ɵɵtext(45, \"\\n                  \");\n        i0.ɵɵelementStart(46, \"label\", 12);\n        i0.ɵɵtext(47, \"ModelYear\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(48, \"\\n                  \");\n        i0.ɵɵelementStart(49, \"select\", 17);\n        i0.ɵɵtext(50, \"\\n                    \");\n        i0.ɵɵtemplate(51, FormPageComponent_option_51_Template, 2, 2, \"option\", 18);\n        i0.ɵɵtext(52, \"\\n                  \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(53, \"\\n                  \");\n        i0.ɵɵelement(54, \"app-form-field-error\", 16);\n        i0.ɵɵtext(55, \"\\n                \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(56, \"\\n              \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(57, \"\\n            \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(58, \"\\n          \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(59, \"\\n          \");\n        i0.ɵɵelementStart(60, \"div\", 19);\n        i0.ɵɵtext(61, \"\\n            \");\n        i0.ɵɵelementStart(62, \"button\", 20);\n        i0.ɵɵtext(63, \"\\n              \");\n        i0.ɵɵelement(64, \"i\", 21);\n        i0.ɵɵtext(65);\n        i0.ɵɵpipe(66, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(67, \"\\n\\n            \");\n        i0.ɵɵelementStart(68, \"button\", 22);\n        i0.ɵɵlistener(\"click\", function FormPageComponent_Template_button_click_68_listener() {\n          return ctx.back();\n        });\n        i0.ɵɵtext(69, \"\\n              \");\n        i0.ɵɵelement(70, \"i\", 23);\n        i0.ɵɵtext(71);\n        i0.ɵɵpipe(72, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(73, \"\\n          \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(74, \"\\n        \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(75, \"\\n        \");\n        i0.ɵɵelement(76, \"div\");\n        i0.ɵɵtext(77, \"\\n      \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(78, \"\\n    \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(79, \"\\n  \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(80, \"\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(81, \"\\n\");\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"titulo\", \"Truck\")(\"items\", i0.ɵɵpureFunction3(20, _c3, i0.ɵɵpureFunction0(16, _c0), i0.ɵɵpureFunction0(17, _c1), i0.ɵɵpureFunction1(18, _c2, ctx.pageTitle)));\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"formGroup\", ctx.formData);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"fullScreen\", false);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(24, _c4, ctx.formData.get(\"model\").touched && ctx.formData.controls[\"model\"].invalid));\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"form-control\", ctx.formData.get(\"model\"));\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(26, _c4, ctx.formData.get(\"modelYear\").touched && ctx.formData.controls[\"modelYear\"].invalid));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.yearModels);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"form-control\", ctx.formData.get(\"modelYear\"));\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"disabled\", ctx.formData.invalid || ctx.submittingForm);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(66, 12, \"Save\"), \"\\n            \");\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(72, 14, \"Back\"), \"\\n            \");\n      }\n    },\n    styles: [\"\"]\n  });\n  return FormPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}